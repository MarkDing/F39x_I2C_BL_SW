C51 COMPILER V9.02   FXXX_TARGETBL_MAIN                                                    03/15/2013 16:33:30 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE FXXX_TARGETBL_MAIN
OBJECT MODULE PLACED IN Fxxx_TargetBL_Main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.exe Fxxx_TargetBL_Main.c DB OE BR INCDIR(C:\SiLabs\MCU\Inc) ROM(SMALL) OT(11,SI
                    -ZE)

line level    source

   1          //-----------------------------------------------------------------------------
   2          // Fxxx_TargetBL_Main.c
   3          //-----------------------------------------------------------------------------
   4          // Copyright (C) 2010 Silicon Laboratories, Inc.
   5          // http://www.silabs.com
   6          //
   7          // Program Description:
   8          //
   9          // The main routine for the Target Bootloader Firmware.
  10          //
  11          // 
  12          //
  13          //
  14          // Target:         C8051Fxxx (Any Silicon Labs Flash MCU)
  15          // Tool chain:     Generic
  16          // Command Line:   None
  17          //
  18          //
  19          // Release 1.0 / 01SEP2010 (PKC)
  20          //    -Initial Revision
  21          //
  22          //-----------------------------------------------------------------------------
  23          
  24          //-----------------------------------------------------------------------------
  25          // Includes
  26          //-----------------------------------------------------------------------------
  27          #include <compiler_defs.h>
  28          #include "Fxxx_SFR_Defs_Wrapper.h"     // This header file will include the
  29                                                 // real MCU register definition file
  30          
  31          #include "Fxxx_Target_Config.h"
  32          #include "Fxxx_Target_Interface.h"
  33          
  34          #include "Fxxx_TargetBL_Config.h"
  35          #include "Fxxx_TargetBL_Interface.h"
  36          
  37          #include "Fxxx_BL131_SMB0_Interface.h"
  38          
  39          //-----------------------------------------------------------------------------
  40          // Global CONSTANTS
  41          //-----------------------------------------------------------------------------
  42          
  43          
  44          
  45          //-----------------------------------------------------------------------------
  46          // Global Variables
  47          //-----------------------------------------------------------------------------
  48          SBIT(BL_Override_Pin, SFR_P1, 0);
  49          
  50          //=============================================================================
  51          // Main Routine
  52          //=============================================================================
  53          void main (void)
  54          {
C51 COMPILER V9.02   FXXX_TARGETBL_MAIN                                                    03/15/2013 16:33:30 PAGE 2   

  55   1         //---------------------------------------
  56   1         // Check the override pin.
  57   1         //---------------------------------------
  58   1         if (!BL_Override_Pin)
  59   1         {
  60   2            // If not in BL Override, jump to application
  61   2            START_APPLICATION ();
  62   2         }
  63   1      
  64   1         //-------------------------------------------
  65   1         // ** BL Mode ** Initialize MCU and Variables
  66   1         //-------------------------------------------
  67   1         Init_Device ();
  68   1      
  69   1         //-------------------------------------------
  70   1         // Main Loop
  71   1         //-------------------------------------------
  72   1      
  73   1         while(1)
  74   1         {
  75   2            // Wait until a command is received
  76   2            SMB0_Op (6);
  77   2      
  78   2            switch (Rx_Buf[0])
  79   2            {
  80   3               case TGT_CMD_RESET_MCU:
  81   3                  Set_TX_TGT_RSP_OK ();
  82   3                  SMB0_Op (1);
  83   3                  RSTSRC = 0x12;          // Initiate software reset with vdd monitor enabled  
  84   3                  break;
  85   3      
  86   3               case TGT_CMD_GET_VERSION:
  87   3                  Set_TX_TGT_BL_VER ();
  88   3                  SMB0_Op (1);
  89   3                  break;
  90   3      
  91   3               case TGT_CMD_ERASE_FLASH_PAGE:
  92   3                  TGT_Erase_Page ();
  93   3                  break;
  94   3      
  95   3               case TGT_CMD_WRITE_FLASH_BYTES:
  96   3                  TGT_Write_Flash ();
  97   3                  break;
  98   3      
  99   3               case TGT_CMD_READ_FLASH_BYTES:
 100   3                  TGT_Read_Flash ();
 101   3                  break;
 102   3      
 103   3               default:
 104   3                  Set_TX_TGT_RSP_UNSUPPORTED_CMD ();
 105   3                  SMB0_Op (1);
 106   3                  break;
 107   3            }
 108   2      
 109   2            // Set flash keys to 0
 110   2            Flash_Key0 = 0;
 111   2            Flash_Key1 = 0;
 112   2         }
 113   1      }
 114          
 115          //-----------------------------------------------------------------------------
 116          // Set_TX_TGT_RSP_OK
C51 COMPILER V9.02   FXXX_TARGETBL_MAIN                                                    03/15/2013 16:33:30 PAGE 3   

 117          //-----------------------------------------------------------------------------
 118          //
 119          // Return Value:  None
 120          // Parameters:    None
 121          //
 122          // Sets TX response code to TGT_RSP_OK.
 123          //-----------------------------------------------------------------------------
 124          void Set_TX_TGT_RSP_OK (void)
 125          {
 126   1         Tx_Buf[0] = TGT_RSP_OK;
 127   1      }
 128          
 129          //-----------------------------------------------------------------------------
 130          // Set_TX_TGT_RSP_PARAMETER_INVALID
 131          //-----------------------------------------------------------------------------
 132          //
 133          // Return Value:  None
 134          // Parameters:    None
 135          //
 136          // Sets TX response code to TGT_RSP_PARAMETER_INVALID.
 137          //-----------------------------------------------------------------------------
 138          void Set_TX_TGT_RSP_PARAMETER_INVALID (void)
 139          {
 140   1         Tx_Buf[0] = TGT_RSP_PARAMETER_INVALID;
 141   1      }
 142          
 143          //-----------------------------------------------------------------------------
 144          // Set_TX_TGT_RSP_PARAMETER_INVALID
 145          //-----------------------------------------------------------------------------
 146          //
 147          // Return Value:  None
 148          // Parameters:    None
 149          //
 150          // Sets TX response code to TGT_RSP_PARAMETER_INVALID.
 151          //-----------------------------------------------------------------------------
 152          void Set_TX_TGT_RSP_UNSUPPORTED_CMD (void)
 153          {
 154   1         Tx_Buf[0] = TGT_RSP_UNSUPPORTED_CMD;
 155   1      }
 156          
 157          //-----------------------------------------------------------------------------
 158          // Set_TX_TGT_BL_VER
 159          //-----------------------------------------------------------------------------
 160          //
 161          // Return Value:  None
 162          // Parameters:    None
 163          //
 164          // Sets TX response code to TGT_BL_VER
 165          //-----------------------------------------------------------------------------
 166          void Set_TX_TGT_BL_VER (void)
 167          {
 168   1         Tx_Buf[0] = TGT_BL_VER;
 169   1      }
 170          //-----------------------------------------------------------------------------
 171          // End Of File
 172          //-----------------------------------------------------------------------------


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     85    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.02   FXXX_TARGETBL_MAIN                                                    03/15/2013 16:33:30 PAGE 4   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
